---
import { getCollection } from 'astro:content';

// Buscar posts da collection
const allPosts = await getCollection('blog');

// Ordenar por data mais recente e limitar a 3 posts
const posts = allPosts
  .sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime())
  .slice(0, 3);
---

<section class="section py-16 bg-gray-50 dark:bg-gray-800/50">
  <div class="container-custom py-8">
    <div class="flex justify-between items-center mb-12">
      <h2 class="text-3xl font-bold">Blog</h2>
      <a
        href="/blog"
        class="py-3 font-semibold underline underline-offset-8 inline-flex items-center justify-center"
      >
        Veja todos os artigos
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="lucide lucide-arrow-right ml-2 h-5 w-5"
        ><path d="M5 12h14"></path><path d="m12 5 7 7-7 7"></path></svg>
      </a>
    </div>
    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
      {posts.map((post, index) => (
        <div
          class="card border border-gray-200 dark:border-gray-700 overflow-hidden slide-up"
          style={`animation-delay: ${index * 100}ms`}
        >
          <a href={`/blog/${post.id}`} class="block">
            {post.data.image && (
              <img
                src={post.data.image}
                alt={post.data.title}
                class="w-full h-48 object-cover"
                loading="lazy"
              />
            )}
          </a>
          <div class="p-6">
            <div class="flex items-center mb-4">
              <span class="text-sm font-medium text-primary-600 dark:text-primary-400">
                {post.data.category}
              </span>
              <span class="mx-2 text-gray-300 dark:text-gray-600">â€¢</span>
              <time class="text-sm text-gray-500 dark:text-gray-400">
                {new Date(post.data.date).toLocaleDateString('pt-BR', {
                  year: 'numeric',
                  month: 'long',
                  day: 'numeric'
                })}
              </time>
            </div>
            <a href={`/blog/${post.id}`} class="block mb-3">
              <h2 class="text-xl font-semibold text-gray-900 dark:text-white hover:text-primary-600 dark:hover:text-primary-400 transition-colors">
                {post.data.title}
              </h2>
            </a>
            <p class="text-gray-600 dark:text-gray-300 mb-6">
              {post.data.excerpt}
            </p>
          </div>
        </div>
      ))}
    </div>
  </div>
</section>
