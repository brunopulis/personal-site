---
import { getCollection } from "astro:content";

const allPosts = await getCollection("blog");

// Ordenar por data mais recente e limitar a 3 posts
const posts = allPosts
  .sort(
    (a, b) =>
      new Date(b.data.publishDate).getTime() -
      new Date(a.data.publishDate).getTime()
  )
  .slice(0, 3);

function formatDate(date: string | number | Date) {
  const formatter = new Intl.DateTimeFormat("pt-BR", {
    year: "numeric",
    month: "long",
    day: "numeric",
  });

  return formatter.format(new Date(date));
}

function toISOString(dateString: string) {
  const date = new Date(dateString);
  return date.toISOString();
}
---

<section class="bg-errie-black-800 px-6 py-20 lg:px-20">
  <div class="mx-auto max-w-7xl">
    <div class="mb-16 text-center">
      <h2 class="mb-6 text-4xl font-bold text-white lg:text-5xl">
        Blog e Artigos
      </h2><p class="mx-auto max-w-3xl text-xl leading-relaxed text-gray-300">
        Compartilho insights, t√©cnicas e aprendizados sobre acessibilidade,
        desenvolvimento, teologia e produtividade que podem te ajudar.
      </p>
    </div>

    <div class="grid gap-8 md:grid-cols-2 lg:grid-cols-3">
			{
        posts.map((post, index) => (
          <a href={"/blog/" + post.id} class="u-url block">
						<div class="text-card-foreground group flex cursor-pointer flex-col gap-6 overflow-hidden rounded-xl border-0 bg-white transition-shadow hover:shadow-xl">
											<div class="h-48 overflow-hidden">
												<img
													src={post.data.image ? post.data.image : '/src/assets/images/image-default.png'}
													alt={post.data.title || ""}
													class="h-full w-full object-cover transition-transform duration-300 group-hover:scale-105"
												/>
											</div>
							
							<div class="p-6">
								<div class="mb-4 flex items-center gap-4">
									<span
										class="focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive [a&]:hover:bg-primary/90 inline-flex w-fit shrink-0 items-center justify-center gap-1 overflow-hidden rounded-md border border-transparent bg-blood-red-800 px-2 py-0.5 text-xs font-medium whitespace-nowrap text-white transition-[color,box-shadow] focus-visible:ring-[3px] [&>svg]:pointer-events-none [&>svg]:size-3"
										>{post.data.category}</span>
										
										<div class="flex items-center gap-2 text-sm text-gray-500">
											<svg
												xmlns="http://www.w3.org/2000/svg"
												width="24"
												height="24"
												viewBox="0 0 24 24"
												fill="none"
												stroke="currentColor"
												stroke-width="2"
												stroke-linecap="round"
												stroke-linejoin="round"
												class="lucide lucide-calendar h-4 w-4"
												aria-hidden="true"
												><path d="M8 2v4"></path><path d="M16 2v4"></path><rect
													width="18"
													height="18"
													x="3"
													y="4"
													rx="2"></rect><path d="M3 10h18"></path>
											</svg>
											<time
												datetime={toISOString(String(post.data.publishDate))}
                  			class="dt-published text-sm text-gray-500 dark:text-gray-400"
                  		>
                  			{formatDate(post.data.publishDate)}
											</time>
									</div><span class="text-sm text-gray-500">5 min</span>
								</div>
								<h3
									class="mb-3 line-clamp-2 text-xl font-semibold text-gray-900 transition-colors group-hover:text-blood-redbg-blood-red-800"
								>
									{post.data.title}
								</h3>
								<p class="mb-4 line-clamp-3 leading-relaxed text-gray-600">
									{post.data.excerpt}
								</p>
								<div class="flex items-center gap-2 font-medium text-blood-redbg-blood-red-800 transition-all group-hover:gap-3">
									<span>Ler artigo</span><svg
										xmlns="http://www.w3.org/2000/svg"
										width="24"
										height="24"
										viewBox="0 0 24 24"
										fill="none"
										stroke="currentColor"
										stroke-width="2"
										stroke-linecap="round"
										stroke-linejoin="round"
										class="lucide lucide-arrow-right h-4 w-4"
										aria-hidden="true"
										><path d="M5 12h14"></path><path d="m12 5 7 7-7 7"></path></svg
									>
								</div>
							</div>
						</div>
					</a>
    </div>

		))
      }
  </div>
			<div class="mt-12 text-center">
      <a
        class="inline-flex cursor-pointer items-center gap-2 text-white transition-colors hover:text-gray-300"
        href="/blog"
        data-discover="true"
        ><span class="text-lg">Ver todos os artigos</span><svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="lucide lucide-arrow-right h-5 w-5"
          aria-hidden="true"
          ><path d="M5 12h14"></path><path d="m12 5 7 7-7 7"></path></svg
        ></a
      >
    </div>
</section>
