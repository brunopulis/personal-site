<div class="email-reply-button">
  <a class="reply-btn share-button" data-title="{{ title or 'Compartilhar' }}" data-text="{{ text or '' }}"
    data-url="{{ url or '' }}" aria-label="Compartilhar">
    <span class="hidden sm:inline">Compartilhar</span>
  </a>
</div>

<style>
  /* Estilo Simple - Inspirado no niqwithq */
  .email-reply-simple {
    margin: 2rem 0;
    padding: 1.5rem;
    background: #f8f9fa;
    border-left: 4px solid #0066cc;
    border-radius: 4px;
  }

  .email-reply-simple p {
    margin: 0;
    font-size: 1rem;
    color: #333;
  }

  .reply-link {
    color: #0066cc;
    text-decoration: none;
    font-weight: 500;
    border-bottom: 2px solid transparent;
    transition: border-color 0.2s;
  }

  .reply-link:hover {
    border-bottom-color: #0066cc;
  }

  /* Estilo Button - Inspirado no kevquirk */
  .email-reply-button {
    margin: 2rem 0;
    text-align: center;
  }

  .reply-btn {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1.5rem;
    background: #0066cc;
    color: white;
    text-decoration: none;
    border-radius: 6px;
    font-weight: 500;
    font-size: 1rem;
    transition: all 0.2s;
    border: 2px solid #0066cc;
    cursor: pointer;
  }

  .reply-btn:hover {
    background: #0052a3;
    border-color: #0052a3;
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 102, 204, 0.3);
  }

  .reply-btn svg {
    flex-shrink: 0;
    width: 1.25rem;
    height: 1.25rem;
  }

  /* Estilo Inline - Mais discreto */
  .email-reply-inline {
    margin: 2rem 0;
    padding: 1rem 0;
    border-top: 1px solid #e0e0e0;
    border-bottom: 1px solid #e0e0e0;
  }

  .email-reply-inline p {
    margin: 0;
    font-size: 0.95rem;
    color: #666;
    text-align: center;
  }

  .reply-link-inline {
    color: #0066cc;
    text-decoration: underline;
    font-weight: 500;
  }

  .reply-link-inline:hover {
    color: #0052a3;
  }

  /* Dark mode support */
  @media (prefers-color-scheme: dark) {
    .email-reply-simple {
      background: #1a1a1a;
      border-left-color: #4d94ff;
    }

    .email-reply-simple p {
      color: #e0e0e0;
    }

    .reply-link {
      color: #4d94ff;
    }

    .reply-link:hover {
      border-bottom-color: #4d94ff;
    }

    .reply-btn {
      background: #4d94ff;
      border-color: #4d94ff;
    }

    .reply-btn:hover {
      background: #3d7dd6;
      border-color: #3d7dd6;
      box-shadow: 0 4px 8px rgba(77, 148, 255, 0.3);
    }

    .email-reply-inline {
      border-color: #333;
    }

    .email-reply-inline p {
      color: #b0b0b0;
    }

    .reply-link-inline {
      color: #4d94ff;
    }

    .reply-link-inline:hover {
      color: #3d7dd6;
    }
  }
</style>

<script>
  (function initShareButtons() {
    function setupShareButton(button) {
      button.addEventListener('click', async () => {
        const title = button.getAttribute('data-title') || '';
        const text = button.getAttribute('data-text') || '';
        const url = button.getAttribute('data-url') || '';

        const shareText = `${text}\n\n${url}`;

        if (navigator.share) {
          try {
            await navigator.share({
              title: title,
              text: shareText,
            });
            console.log('Compartilhado com sucesso!');
          } catch (err) {
            if (err instanceof Error && err.name !== 'AbortError') {
              console.error('Erro ao compartilhar:', err);
              fallbackShare(shareText);
            }
          }
        } else {
          fallbackShare(shareText);
        }
      });
    }

    function fallbackShare(text) {
      if (navigator.clipboard) {
        navigator.clipboard.writeText(text).then(() => {
          showNotification('Texto copiado para a área de transferência! Cole no seu app do Fediverso.');
        }).catch(err => {
          console.error('Erro ao copiar:', err);
          showNotification('Erro ao copiar texto', true);
        });
      } else {
        const textArea = document.createElement('textarea');
        textArea.value = text;
        textArea.style.position = 'fixed';
        textArea.style.left = '-999999px';
        document.body.appendChild(textArea);
        textArea.select();
        try {
          document.execCommand('copy');
          showNotification('Texto copiado para a área de transferência!');
        } catch (err) {
          console.error('Erro ao copiar:', err);
          showNotification('Erro ao copiar texto', true);
        }
        document.body.removeChild(textArea);
      }
    }

    function showNotification(message, isError = false) {
      const toast = document.createElement('div');
      toast.className = `fixed bottom-4 right-4 px-6 py-3 rounded-lg shadow-lg text-white transition-opacity duration-300 ${isError ? 'bg-red-600' : 'bg-green-600'
        }`;
      toast.textContent = message;
      toast.style.opacity = '0';

      document.body.appendChild(toast);

      setTimeout(() => {
        toast.style.opacity = '1';
      }, 10);

      setTimeout(() => {
        toast.style.opacity = '0';
        setTimeout(() => {
          document.body.removeChild(toast);
        }, 300);
      }, 3000);
    }

    // Setup botões existentes
    document.querySelectorAll('.share-button').forEach(setupShareButton);

    // Observer para novos botões (dinâmicos)
    const observer = new MutationObserver(() => {
      document.querySelectorAll('.share-button:not([data-initialized])').forEach(button => {
        button.setAttribute('data-initialized', 'true');
        setupShareButton(button);
      });
    });

    observer.observe(document.body, { childList: true, subtree: true });
  })();
</script>