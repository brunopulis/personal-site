---
import { getCollection, render } from "astro:content";

import Layout from "@/layouts/Layout.astro";
import Header from "@/components/Header.astro";
import GoBack from "@/components/GoBack.astro";
import ShareArticle from "@/components/ShareArticle.astro";
import Footer from "@/components/Footer.astro";

// Gerar rotas para todos os posts
export async function getStaticPaths() {
  const posts = await getCollection("blog");

  return posts.map(post => ({
    params: { slug: post.id },
    props: { post },
  }));
}

// Receber o post das props
const { post } = Astro.props;
const { Content } = await render(post);

// Formatar data para pt-BR
const formattedDate = new Date(post.data.date).toLocaleDateString("pt-BR", {
  year: "numeric",
  month: "long",
  day: "numeric",
});

const isoDate = new Date(post.data.date).toISOString();
---

<Layout title={`${post.data.title} + 'Bruno Pulis'`} description="Artigos sobre desenvolvimento, acessibilidade e qualidade de software">
  <Header />
  <main>
    <article class="pt-32 pb-16 md:pt-40 md:pb-24">
      <div class="container mx-auto max-w-4xl">
        <GoBack />
        <div class="mb-6 flex items-center">
          <span
            class="bg-red-950 text-white dark:text-primary-300 inline-block rounded-full px-3 py-1 text-sm font-medium"
          >
            {post.data.category}
          </span>
          <span class="mx-2 text-gray-300 dark:text-gray-600">â€¢</span>
          <time class="text-gray-600 dark:text-gray-400" datetime={isoDate}>{formattedDate}</time>
        </div>
        <h1
          class="mb-6 text-3xl font-bold text-gray-900 md:text-4xl lg:text-5xl dark:text-white"
        >
          {post.data.title}
        </h1>
        {
          post.data.coverImage && (
            <img
              src={post.data.coverImage}
              class="mb-10 h-auto w-full rounded-xl object-cover"
              alt={post.data.title || ""}
              style="max-height: 500px;"
            />
          )
        }
        <div class="prose prose-lg dark:prose-invert max-w-none">
          <Content />
        </div>

        <ShareArticle />
      </div>
    </article>
    <Footer />
  </main>
</Layout>

<style>
  h2 {
    margin: 24px 0 !important;
  }
</style>