---
import Layout from "@/layouts/Layout.astro";
import Header from "@/components/Header.astro";
import Footer from "@/components/Footer.astro";
import HeroSection from "@/components/HeroSection.astro";

import { getCollection } from "astro:content";

const posts  = await getCollection("blog");

const sortedPosts = posts.sort((a, b) => {
  return new Date(b.data.date || 0).getTime() - new Date(a.data.date || 0).getTime();
});
const categories = [
  ...new Set(posts.map((post) => post.data.category).filter(Boolean))
].sort((a, b) => a.localeCompare(b));
---

<Layout title="Blog - Bruno Pulis" description="Artigos sobre desenvolvimento, acessibilidade e qualidade de software">
  <Header />
  <main>
    <HeroSection
      title="Blog"
      highlightText="Artigos"
      description="Compartilhando conhecimento sobre desenvolvimento, acessibilidade e qualidade de software."
    />

    <div class="container-custom py-8">
      <!-- Filtro por Categorias -->
      <div class="flex flex-wrap gap-4 justify-center mb-12">
        <a href="/blog" class="px-4 py-2 rounded-full bg-primary-600 text-white font-medium text-sm hover:bg-primary-700 transition-colors">
          Todos os artigos
        </a>
        {categories.map((category) => (
          <a
            href={`/blog/categoria/${category}`}
            class="px-4 py-2 rounded-full bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 font-medium text-sm hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors"
          >
            {category}
          </a>
        ))}
      </div>

      <!-- Lista de Posts -->
      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
        {sortedPosts.map((post, index) => (
          <article class="card border border-gray-200 dark:border-gray-700 overflow-hidden slide-up" 
            style={`animation-delay: ${index * 100}ms`}
          >
            <a href={"/blog/" + post.id} class="block">
              {post.data.coverImage && (
                <img
                  src={post.data.coverImage}
                  alt={post.data.title}
                  class="w-full h-48 object-cover"
                  loading="lazy"
                />
              )}
            </a>
            <div class="p-6">
              <div class="flex items-center gap-4 mb-4">
                <span class="text-sm font-medium text-primary-600 dark:text-primary-400">
                  {post.data.category}
                </span>
                <time class="text-sm text-gray-500 dark:text-gray-400">
                  {new Date(post.data.date).toLocaleDateString('pt-BR', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                  })}
                </time>
              </div>
              
              <a href={"/blog/" + post.id} class="block mb-3">
                <h2 class="text-xl font-semibold text-gray-900 dark:text-white hover:text-primary-600 dark:hover:text-primary-400 transition-colors">
                  {post.data.title}
                </h2>
              </a>
              
              <p class="text-gray-600 dark:text-gray-300 mb-6">
                {post.data.excerpt}
              </p>
            </div>
          </article>
        ))}
      </div>
    </div>
  </main>
  <Footer />
</Layout>