---
import { getCollection } from "astro:content";

import Layout from "@/layouts/Layout.astro";
import Header from "@/components/Header.astro";
import HeroSection from "@/components/HeroSection.astro";
import Footer from "@/components/Footer.astro";
import Pagination from "@/components/Pagination.astro";


export async function getStaticPaths({ paginate }) {
  // Obter todos os posts do blog
  const allPosts = await getCollection("blog", ({ data }) => {
    return data.draft !== true;
  });

  return paginate(allPosts, { pageSize: 6 })
}

const { page } = Astro.props;
const pathname = new URL(Astro.request.url).pathname.split('/');
const firstPath = pathname[1];

function formatDate(date) {
  return new Date(date).toLocaleDateString('pt-BR', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  });
}
---

<Layout title="Blog - Bruno Pulis" description="Artigos sobre desenvolvimento, acessibilidade e qualidade de software">
  <Header />
  <!-- <HeroSection
    title="Blog"
    description="Compartilhando conhecimento sobre desenvolvimento, acessibilidade e qualidade de software."
  /> -->
  <section class="body-font bg-red-950 text-white">
      <div
        class="container mx-auto flex flex-col items-center px-5 py-12 md:flex-row"
      >
        <div
          class="mb-16 flex flex-col items-center text-center md:mb-0 md:w-1/2 md:items-start md:pr-16 md:text-left lg:flex-grow lg:pr-24"
        >
          <hr class="mb-5 h-1 w-24 bg-white" />
          <h1 class="title-font mb-4 text-3xl font-medium sm:text-4xl">
           Blog
          </h1>
          <p class="mb-3 text-lg leading-relaxed font-light">
            Compartilhando conhecimento sobre desenvolvimento, acessibilidade e qualidade de software.
          </p>
        </div>
        <div class="w-5/6 md:w-1/2 lg:w-full lg:max-w-lg">
          <img
            class="rounded-lg object-cover object-center"
            alt="hero"
            src="https://images.unsplash.com/photo-1522071820081-009f0129c71c?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1000&q=80"
          />
        </div>
      </div>
    </section>
  <main>
    <!-- Filtro por Categorias -->
    <div class="container mx-auto px-5 py-8">
      <ul>
        {
          page.data.map((post) => (
            <li class="block border-b border-gray-200 pb-12">
              <article class="space-y-5 pt-12">
                <div class="space-x-2 text-sm text-gray-500">
                  <time datetime={post.data.date}>
                    {formatDate(post.data.date)}
                  </time>
                  <span>/</span>
                  <span>{post.data.category}</span>

                  <h3 class="text-xl font-semibold text-gray-900 hover:text-red-950 transition-colors">
                    <a href={`/blog/${post.id}`} class="block mb-3">
                      {post.data.title}
                    </a>
                  </h3>

                  <p class="text-gray-600 dark:text-gray-300 mb-6">
                    {post.data.excerpt}
                  </p>
                </div>
              </article>
            </li>
          ))
        }
      </ul>

      <Pagination
        length={page.lastPage}
        currentUrl={page.url.current}
        currentPage={page.currentPage}
        firstUrl={`/${firstPath}`}
        prevUrl={page.url.prev}
        nextUrl={page.url.next}
        lastUrl={`/${firstPath}/${page.lastPage}`}
      />
    </div>
  </main>
  <Footer />
</Layout>