---
import type { GetStaticPathsOptions, Page } from "astro";
import { type CollectionEntry, getCollection } from "astro:content";

import Layout from "@/layouts/Layout.astro";
import Header from "@/components/layout/Header.astro";
import HeroSection from "@/components/layout/HeroSection.astro";
import Footer from "@/components/layout/Footer.astro";
import Pagination from "@/components/Pagination.astro";

export async function getStaticPaths({ paginate }: GetStaticPathsOptions) {
  const posts = await getCollection("blog", ({ data }) => {
    return data.draft !== true;
  });

  const sortedPosts = posts.sort((a, b) => {
    return (
      new Date(b.data.publishDate).valueOf() -
      new Date(a.data.publishDate).valueOf()
    );
  });

  return paginate(sortedPosts, { pageSize: 6 });
}

type Props = { page: Page<CollectionEntry<"blog">> };

const { page } = Astro.props;
const posts = page.data;

function formatDate(date: string | number | Date) {
  const formatter = new Intl.DateTimeFormat("pt-BR", {
    year: "numeric",
    month: "long",
    day: "numeric",
  });

  return formatter.format(new Date(date));
}

function toISOString(dateString: string) {
  const date = new Date(dateString);
  return date.toISOString();
}
---

<Layout
  title="Blog - Bruno Pulis"
  description="Artigos sobre desenvolvimento, acessibilidade e qualidade de software"
>
  <Header />
  <main>
    <HeroSection
      title="Textos"
      description="Artigos, reviews, opiniões pessoais e pitadas ácidas de humor."
    />

    <div class="container-custom py-8">
      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
        {
          posts.map((post, index) => (
            <article class="bg-white rounded-xl shadow-lg overflow-hidden hover:shadow-xl transition-shadow duration-300 group">
              <div class="relative">
                <img src={post.data.image ?? "/src/assets/images/image-default.png"}
                     alt="WCAG 2.1: Guia Completo para Implementação"
                     class="w-full h-48 object-cover group-hover:scale-105 transition-transform duration-300" />

                <div class="absolute top-4 left-4">
                  <span class="bg-blood-red-800 text-white text-xs font-medium px-3 py-1 rounded-full">{post.data.category}</span>
                </div>
              </div>

              <div class="p-6">
                <h3 class="text-xl font-bold text-gray-900 mb-3 group-hover:text-blood-red-800 transition-colors">
                  <a href={"/blog/" + post.id} class="u-url block hover:text-blood-red-800">
                    {post.data.title}
                  </a>
                </h3>
                <p class="text-gray-600 mb-4 leading-relaxed">
                  {post.data.excerpt}
                </p>
              </div>
            </article>
          ))
        }
      </div>

      <Pagination
        currentPage={page.currentPage}
        lastPage={page.lastPage}
        prevUrl={page.url.prev}
        nextUrl={page.url.next}
      />
    </div>
  </main>
  <Footer />
</Layout>
