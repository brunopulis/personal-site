---
import { type CollectionEntry, getCollection } from "astro:content";
import { ArrowRight } from "@lucide/astro";
import type { GetStaticPathsOptions, Page } from "astro";

import Layout from "@layouts/Layout.astro";
import Header from "@components/layout/Header.astro";
import BlogSidebar from "@components/BlogSidebar.astro";
import Pagination from "@components/Pagination.astro";
import Footer from "@components/layout/Footer.astro";

import { getAllTags } from "@utils/getAllTags";

export async function getStaticPaths({ paginate }: GetStaticPathsOptions) {
	const posts = await getCollection("blog", ({ data }) => {
		return data.draft !== true;
	});

	const sortedPosts = posts.sort((a, b) => {
		return (
			new Date(b.data.publishDate).valueOf() -
			new Date(a.data.publishDate).valueOf()
		);
	});

	return paginate(sortedPosts, { pageSize: 6 });
}

type Props = { page: Page<CollectionEntry<"blog">> };

const { page } = Astro.props;
const posts = page.data;
const tags = getAllTags(posts);

function formatDate(date: string | number | Date) {
	const formatter = new Intl.DateTimeFormat("pt-BR", {
		year: "numeric",
		month: "long",
		day: "numeric",
	});

	return formatter.format(new Date(date));
}

function toISOString(dateString: string) {
	const date = new Date(dateString);
	return date.toISOString();
}

export const prerender = true;
---

<Layout title="Blog - Bruno Pulis" description="Artigos sobre desenvolvimento, acessibilidade e qualidade de software">
  <Header />
  <main id="main-content">
    <section class="relative overflow-hidden bg-linear-to-br from-red-900 via-red-800 to-red-950 text-white">
      <div class="absolute inset-0 opacity-10">
        <div class="absolute top-20 left-10 h-64 w-64 rounded-full bg-white blur-3xl"></div>
        <div class="absolute right-10 bottom-20 h-96 w-96 rounded-full bg-red-400 blur-3xl"></div>
      </div>
      <div class="relative mx-auto grid max-w-7xl items-center gap-12 px-6 py-24 md:grid-cols-2">
        <div>
          <h1 class="mb-6 text-5xl leading-tight font-bold">Coisas que tenho pensado</h1>
          <p class="text-xl leading-relaxed font-light text-white">
            Escrevo sobre acessibilidade, tecnologia, teologia, produtividade.
          </p>
          <p class="text-xl leading-relaxed font-light text-white">Nem tudo é técnico, às vezes é só sobre a vida.</p>
        </div>
      </div>
    </section>

    <section class="bg-white py-16">
      <div class="mx-auto max-w-7xl px-6">
        <div class="grid gap-8 lg:grid-cols-3">
          <div class="lg:col-span-2">
            <div class="space-y-8">
              <ul>
                {
                posts.map((post, index) => (
                    <li class="py-4">
                      <h3 class="mb-4 text-3xl font-bold">
                        <a href={'/blog/' + post.id} class="u-url group block">
                          {post.data.title}
                        </a>
                      </h3>
                      <p class="text-xl font-light my-4 flex items-center gap-4">
                        <time class="font-display text-errie-black-900">
                          Publicado em:
                          {formatDate(post.data.publishDate)}
                        </time>
                      </p>
                      <p class="mb-6 text-2xl font-light text-errie-black-900">
                        {post.data.excerpt}
                      </p>
                      <a
                        href={'/blog/' + post.id}
                        aria-labelledby={`post-${index}`}
                        class="flex items-center gap-2 font-semibold text-errie-black-900 underline underline-offset-8 transition hover:no-underline"
                      >
                        Ler artigo completo
                        <ArrowRight class="h-3 w-3" aria-hidden="true" />
                      </a>
                    </li>
                  ))
                }
              </ul>
            </div>

            <Pagination
              currentPage={page.currentPage}
              lastPage={page.lastPage}
              prevUrl={page.url.prev}
              nextUrl={page.url.next}
            />
          </div>
          <BlogSidebar tags={tags} />
        </div>
      </div>
    </section>
  </main>
  <Footer />
</Layout>

