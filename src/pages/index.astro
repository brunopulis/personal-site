---
import Hero from '@components/home/Hero.astro';
import Newsletter from '@components/home/Newsletter.astro';
import Work from '@components/home/Work.astro';
import Writing from '@components/home/Writing.astro';
import Stream from '@components/stream/Stream.astro';
import type { Language } from '@i18n/index';
import { getLanguageFromPath, getLocalizedPath, useTranslations } from '@i18n/utils';
import Layout from '@layout/Layout.astro';
import { getCollection } from 'astro:content';

const blogPosts = await getCollection('blog');
const streamItems = await getCollection('stream');

const recentBlogPosts = blogPosts
  .sort((a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf())
  .slice(0, 4);

const validStreamItems = streamItems.filter(
  (item) => item.id.startsWith('pt-br/') && item.data.pubDate && item.data.pubDate instanceof Date
);

const streams = validStreamItems
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 4);

const lang = getLanguageFromPath(Astro.url.pathname) as Language;
const t = useTranslations(lang);
---

<Layout
  title="Bruno Pulis - Engenheiro de Acessibilidade"
  description="Bruno Pulis - Mentor e engenheiro de acessibilidade web, desenvolvendo uma web para todos"
  currentLocale="pt-br"
  routeKey="index"
>
  <Hero t={t} currentLang={lang} getLocalizedPath={getLocalizedPath} />
  <Stream streams={streams} t={t} locale={lang} />
  <Writing posts={recentBlogPosts} t={t} locale={lang} />
  <Work />
  <Newsletter />
</Layout>
