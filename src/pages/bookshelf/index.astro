---
import Layout from '@/layouts/Layout.astro'
import Header from '@/components/Header.astro'
import HeroSection from '@/components/HeroSection.astro'
import Footer from '@/components/Footer.astro'

interface Book {
	title: string
	author: string
	cover: string
	rating: 1 | 2 | 3 | 4 | 5
	year: number
}

const books: Book[] = [
	{
		title: 'O Príncipe',
		author: 'Maquiavel',
		cover: 'https://m.media-amazon.com/images/I/812BaW4MacL._SY385_.jpg',
		rating: 5,
		year: 2023
	},
	{
		title: 'O Príncipe',
		author: 'Maquiavel',
		cover: 'https://m.media-amazon.com/images/I/812BaW4MacL._SY385_.jpg',
		rating: 5,
		year: 2023
	},
	{
		title: 'O Príncipe',
		author: 'Maquiavel',
		cover: 'https://m.media-amazon.com/images/I/812BaW4MacL._SY385_.jpg',
		rating: 5,
		year: 2025
	},
	{
		title: 'O Príncipe',
		author: 'Maquiavel',
		cover: 'https://m.media-amazon.com/images/I/812BaW4MacL._SY385_.jpg',
		rating: 5,
		year: 2025
	},
	{
		title: 'O Príncipe',
		author: 'Maquiavel',
		cover: 'https://m.media-amazon.com/images/I/812BaW4MacL._SY385_.jpg',
		rating: 5,
		year: 2025
	},
	{
		title: 'O Príncipe',
		author: 'Maquiavel',
		cover: 'https://m.media-amazon.com/images/I/812BaW4MacL._SY385_.jpg',
		rating: 5,
		year: 2025
	},
	{
		title: 'O Príncipe',
		author: 'Maquiavel',
		cover: 'https://m.media-amazon.com/images/I/812BaW4MacL._SY385_.jpg',
		rating: 5,
		year: 2025
	}
	// ... adicione mais livros aqui
]

import { Image } from 'astro:assets'
import { getCollection } from 'astro:content'

// Agrupar livros por ano
const booksByYear = books.reduce(
	(acc, book) => {
		const year = book.year
		if (!acc[year]) {
			acc[year] = []
		}
		acc[year].push(book)
		return acc
	},
	{} as Record<number, typeof books>
)

// Ordenar anos em ordem decrescente
const years = Object.keys(booksByYear)
	.map(Number)
	.sort((a, b) => b - a)
---

<Layout title="Minha Estante - Bruno Pulis" description="Livros que li ao longo dos anos">
	<Header />
	<main id="main-content">
		<section class="relative overflow-hidden pb-16 pt-24 md:pb-20 md:pt-32">
			<div class="container relative z-10 mx-auto">
				<div class="mx-auto px-4">
					<h1
						class="animate-slide-down mb-4 text-3xl md:mb-6 md:text-4xl lg:text-5xl"
					>
						Minha biblioteca
					</h1>
					<p
						class="animate-slide-up mb-6 text-lgmd:mb-8 md:text-xl dark:text-gray-300"
						style="animation-delay: 200ms"
					>
						Coletânea de livro que ao longo dos anos.
					</p>
				</div>
			</div>
		</section>

		<section class="bg-white py-16 dark:bg-gray-800">
			<div class="container mx-auto py-8">
				{
					years.map((year) => (
						<section class="mb-12">
							<div class="mb-6 flex items-center">
								<h2 class="text-2xl font-bold text-brand-900">{year}</h2>
								<p class="ml-10">
									{booksByYear[year].length}{' '}
									{booksByYear[year].length === 1 ? 'livro lido' : 'livros lidos'}
								</p>
							</div>

							<div class="grid grid-cols-2 gap-6 md:grid-cols-3 lg:grid-cols-4">
								{booksByYear[year].map((book) => (
									<article class="mb-5 bg-white">
										<div class="">
											<Image
												src={book.cover}
												alt={`Capa do livro ${book.title}`}
												class="w-full object-cover"
												width={180}
												height={270}
											/>
										</div>

										<div class="p-2">
											<h3 class="mb-1 text-lg font-bold">{book.title}</h3>
											<p class="mb-2 text-sm text-gray-600">{book.author}</p>

											<div class="flex items-center">
												{Array.from({ length: 5 }).map((_, index) => (
													<svg
														xmlns="http://www.w3.org/2000/svg"
														class={`h-5 w-5 ${
															index < book.rating
																? 'text-yellow-400'
																: 'text-gray-300 dark:text-gray-600'
														}`}
														viewBox="0 0 20 20"
														fill="currentColor"
													>
														<path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
													</svg>
												))}
											</div>
										</div>
									</article>
								))}
							</div>
						</section>
					))
				}
			</div>
		</section>
	</main>
	<Footer />
</Layout>
